---
- hosts: default
  gather_facts: no
  pre_tasks:
    - name: Refresh snap
      ansible.builtin.shell:
        cmd: snap refresh
    - name: Install snap packages
      community.general.snap:
        name: "{{ item }}"
      with_items:
        - docker
    - name: Update apt package list
      ansible.builtin.apt:
        update_cache: yes
    - name: Install apt packages
      ansible.builtin.apt:
        name: "{{ item }}"
      with_items:
        - ncdu
        - python3-pip
    - name: Install kubernetes package
      ansible.builtin.pip:
        name: "{{ item }}"
      with_items:
        - openshift
  roles:
    - journald
    - role: frpc
      vars:
        key_name: cysista-proxy/frps
        frpc_ini_file: frpc.ini.j2
    - microk8s
    - ingress-nginx
    - cert-manager
    - role: kube-prometheus-stack
      vars:
        key_name: cysista-develop/kube-prometheus-stack
    - role: gitlab
      vars:
        root_key_name: cysista-develop/gitlab
        smtp_key_name: cysista-develop/gitlab-smtp
    - role: argo-cd
      vars:
        redis_key_name: cysista-develop/argo-cd-redis
        key_name: cysista-develop/argo-cd
    - role: wordpress
      vars:
        wp_key_name: cysista-develop/wordpress
        wp_db_root_key_name: cysista-develop/wordpress-db-root
        wp_db_key_name: cysista-develop/wordpress-db
