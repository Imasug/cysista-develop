---
- hosts: default
  gather_facts: no
  pre_tasks:
    - name: Refresh snap
      ansible.builtin.shell:
        cmd: snap refresh
    - name: Update apt package list
      ansible.builtin.apt:
        update_cache: yes
    - name: Install base dependencies
      ansible.builtin.apt:
        name: "{{ item }}"
      with_items:
        - python3-pip
    - name: Install kubernetes package
      ansible.builtin.pip:
        name: "{{ item }}"
      with_items:
        - openshift
  roles:
    - role: frpc
      vars:
        key_name: cysista-proxy/frps
        frpc_ini_file: frpc.ini.j2
    - microk8s
    - ingress-nginx
    - cert-manager
    - kube-prometheus-stack
